doctype html
html
    head
        // application css
        link(rel='stylesheet', href='/stylesheets/style.css')
        meta(name='viewport', content='width=device-width, initial-scale=1, height=device-height')
        meta(charset='utf-8')

        script(src='https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js')
        script(src='main.js', type='text/javascript')
        script(src='http://code.jquery.com/ui/1.11.4/jquery-ui.js')

    body.unselectable.wrapper

        // Trigger/Open The Modal
        div(style='width: 100%; height: 3.5em;')
            div(style='float: right; padding: 10px 10px 10px 10px;')
                button#connectBtn(onclick="$('#connectModal')[0].style.display = \"block\"") Connect
            div(style='float: right; padding: 10px 10px 10px 10px; width: 200px')
                //- button#settingsBtn Settings
                .drop-button-wrap
                    input#settings(type='checkbox')
                    label#settingsLabel.drop-button(for='settings') Settings
                    .drop-pop(style="z-index: 1")
                        .show-large
                            button#createPlaylistBtn(type='reset') Create Playlist
                            button#editPlaylistsBtn(type='reset') Edit Playlists
                        button#assignPlaylistsBtn(type='reset') Assign Playlist
                        button#changeLangBtn(type='reset') Language
                        button#viewVideosBtn(type='reset') View Videos
                        button#getSlavesBtn(type='reset', onclick=('getSlaves()')) Get Slaves

        // The Modal
        #connectModal.modal
            // Modal content
            .modal-content.autoModal(style='display: table')
                span#connectClose.close ×
                div
                    form#IPentry(method='post', style='display: block', onsubmit='return false;', autocomplete='on')
                        h4#enterIPTitle(style='text-align:center; padding-top: 15px') Please enter the IP Address of the robot below
                        input#IP(style='display: inline-block; width: 100%;', type='text', placeholder='IP Address', tabindex='1', required='', autofocus='')
                div(style='text-align:center')
                    button#connectSave(style='display: block; margin: auto;', onclick='createSession()') Save
                    
        #childModal.modal
          .modal-content.autoModal(style='display: table')
              span#childClose.close ×
              div
                  form#childsName(method='post', style='display: block', onsubmit='return false;', autocomplete='on')
                      h4#enterNameTitle(style='text-align:center; padding-top: 15px') Please enter the name of the child
                      input#cName(style='display: inline-block; width: 100%;', type='text', placeholder='Childs name', tabindex='1', required='', autofocus='')
              div(style='text-align:center')
                  button#childSave(style='display: block; margin: auto;') Save
                  
        #restoreModal.modal 
          .modal-content.autoModal(style='display: table')
              span#restoreClose.close ×
              div
                  form#restoreForm(method='post', style='display: block', onsubmit='return false;', autocomplete='on')
                      h4#restoreTitle(style='text-align:center; padding-top: 15px') You have a previous session stored for a child named: %child%. Would you like to restore it?
              div(style='text-align:center')
                  button#restoreYes(style='display: block; margin: auto; float: left; width: 49%') Yes
                  button#restoreNo(style='display: block; margin: auto; float: right; width: 49%') No

        #createModal.modal
            .modal-content(style='min-width: 680px;')
                span#createClose.close ×
                h4#createPlaylistTitle.center Create Playlist
                form#playlistForm(style='margin: auto; margin-top: 20px; display: inline-block; text-align:center;', onsubmit='return false;', method='post', autocomplete='on')
                    div(style='margin: auto; margin-left: -40px; display: block; min-width: 680px')
                        input#playlistName(style='margin: auto; text-align: center; min-width: 250px', type='text', placeholder='Enter a name for your playlist', tabindex='3', autofocus='')
                        | &nbsp;
                        | &nbsp;
                        input#savePlaylistBtn(style='margin: auto; margin-bottom: 10px;', type='submit', value='Save', onclick='savePlaylist()')
                    div(style='margin: auto; display: inline-block; min-width: 680px')
                        ul#behaveListAvailable.sortable.connectedSortable
                        ul#behaveListPlaylist.sortable.connectedSortable
        
        #assignModal.modal
            .modal-content.autoModal
                span#assignClose.close ×
                h4#assignPlaylistTitle.center Assign Playlist
                form#assignForm(style='margin: auto; margin-top: 20px; display: block; text-align:center;', onsubmit='return false;', method='post', autocomplete='on')
                    div(style='margin: auto; display: block')
                        div
                            button#mainBehave Interaction
                            | &nbsp;
                            | &nbsp;
                            select#mainBehaviour
                        div
                            button#positiveBehave Positive
                            | &nbsp;
                            | &nbsp;
                            select#positiveBehaviour
                        div
                            button#negativeBehave Negative
                            | &nbsp;
                            | &nbsp;
                            select#negativeBehaviour
                        div
                            button#saveAssignments(onclick='saveAssigned()') Save

        #editModal.modal
            .modal-content
                span#editClose.close x
                h4#editPlaylistsTitle.center Edit Playlists
                form#playlistForm(style='margin: auto; margin-top: 20px; display: inline-block; text-align:center;', onsubmit='return false;', method='post', autocomplete='on')
                    div(style='margin: auto; display: block')
                        button#deleteAll(style='float: center', onclick='clearPlaylists()') Delete All Playlists
        
        #viewModal.modal
            .modal-content
                span#viewClose.close x
                h4#viewVideosTitle.center View Videos
                form#viewForm(style='margin-top: 10px; display: block; text-align: center;', method='post', onsubmit='return false;', autocomplete='on')

        #videoModal.modal
            .modal-content
                span#videoClose.close x
                form#videoForm(style='margin-top: 10px; display: block; text-align: center;', method='post', onsubmit='return false;', autocomplete='on')
        
        #langModal.modal
            .modal-content
                span#langClose.close x
                h4#changeLangTitle.center(style='margin: auto') Change Language
                form#langForm(style='margin-top: 10px; display: block; text-align: center;', method='post', onsubmit='return false;', autocomplete='on')
                  div#langRadioContainer.container(style='text-align: center; margin-top: 20px;')
                
        form#executionForm(style='position: absolute; margin-left: auto; margin-right: auto; left: 0; right: 0; margin-top: 10px;', method='post', onsubmit='return false;', autocomplete='on')
            div
                h4#executionFormTitle(style='text-align:center; padding-top: 15px') Behaviour Execution
            div
                button#replayB(style='float: left; width: 49%; height: 66px', onclick='playCurrent("main", this)') Repeat 
                button#nextB(style='float: right; width: 49%; height: 66px', onclick='playNext("main", this)') Next
            div
                input#sayText(style='margin-bottom: 10px; margin-top: 5px; max-width: 49%;', type='text', placeholder='Enter text to say', tabindex='3', autofocus='')
                button#sayBtn(style='float: right; width: 49%; margin-top: 7px;', type='submit', onclick='say()') Submit
            div
                button#posB(style='float: left; width: 49%', onclick='playNext("pos", this)') Positive
                button#negB(style='float: right; width: 49%', onclick='playNext("neg", this)') Negative
            divconnectedUserMapSlave
                button#stopB.red(style='float: centre; width: 100%;', onclick='stopBehaviour()') STOP

        div#debugDiv.footer(style="margin-top: 10px; background-color: black; color: green; overflow-y: scroll;")
        script.
            $(function() {
                $(".sortable").sortable({
                    connectWith: ".connectedSortable"
                }).disableSelection();
            });
            
            $(".close").click(function() {
              closeModal(this.parentElement.parentElement.id);
            })

            $( document ).ready(function() {
                modalEvents();
                $.when(loadLanguage(), loadPlaylists()).then(function() {
                  attemptAutoConnect();
                });
            });
            
            if (typeof console != "undefined") 
                if (typeof console.log != 'undefined')
                    console.olog = console.log;
                else
                    console.olog = function() {};
            
            console.log = function(message) {
                console.olog(message);
                if (message !== undefined) {
                    $('#debugDiv').append('<p> > ' + getTime() + " " + message + '</p>');
                    document.getElementById('debugDiv').scrollTop = document.getElementById('debugDiv').scrollHeight;
                }
            };
            console.error = console.debug = console.info =  console.log

            window.onbeforeunload = function() {
                stopBehaviour();
            };


        script(src='http://localhost:3000/socket.io/socket.io.js')
        script.
          var socket = io.connect('http://localhost:3000');
          socket.emit('recieveUserNameMaster', {
          //normally this would be dynamically added based on user input, but for examples sake
            name: 'master-'
          });

        // qimessaging & jquery stuff
        script(src='/libs/qimessaging/1.0/qimessaging.js')
        script(src='/libs/qimessaging/1.0/socket.io.min.js')
        script(src='/scripts/Session.js')
        script(src='/scripts/Robot.js')
        script(src='/scripts/Playlist.js')
        script(src='/scripts/Assigned.js')
