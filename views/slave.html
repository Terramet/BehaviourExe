<!DOCTYPE html>
<html lang='en'>

<head>

  <link rel="stylesheet" href="/stylesheets/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, height=device-height">
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="libs/jquery.ajax-cross-origin.min.js"></script>
  <script src="main.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
  <meta name='description' content=''>
  <meta name='author' content=''>

  <title>Behaviour Executer</title>

  <!-- Bootstrap core CSS -->
  <link href='vendor/bootstrap/css/bootstrap.css' rel='stylesheet'>
  <link href='css/side-bar.css' rel='stylesheet'>
  <link href='css/style.css' rel='stylesheet'>
  <link href='css/animate.css' rel='stylesheet'>

  <style>
        * {
            margin: 0;
            padding: 0;
        }
        .imgbox {
            display: grid;
            height: 100%;
        }
        .center-fit {
            max-width: 100%;
            max-height: 100vh;
            margin: auto;
        }
    </style>

</head>

  <body>
    <div class='justify-content-center'>
      <form id="socketID" style='text-align: center;'></form>
    </div>
    <div id='imageBox' class="imgbox">

    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.dev.js"></script>

    <script>

    var presentation = null
    var socket = io.connect(window.location.href.split(':8')[0] + ':3000');

    socket.on('connect', function() {
      $('#socketID')[0].innerHTML = socket.id
      $('#socketID')[0].style.display = 'block'
      socket.emit('recieveUserNameSlave', {
        name: 'slave-'
      });
    });

    socket.on('message', function(m) {
      console.log(m)
      socket.emit('sendToMaster', {
        socket: m.masterSocket,
        slaveSocket: socket.id,
        message: 'Connected',
        requestPresentation: true
      })
    });

    socket.on('presentation', function(m) {
      console.log(m)
      let data = { pres: m.message }
      $.ajax({
        crossOrigin: true,
        type: 'POST',
        url: window.location.href + '/getPresentation',
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function(d) {
          console.log(d)
          d = JSON.parse(d)
          d.img.forEach((img) => {
            console.log(img)
            $('#socketID')[0].style.display = 'none';

            let image = document.createElement('img');
            let id = img.split('.')[0];
            image.setAttribute('id', id);
            image.setAttribute('src', '/slave/get/' + d.dir + '/' + img);
            image.classList.add('center-fit');
            image.style.display = 'none';

            $("#imageBox")[0].appendChild(image);
          })

          $('#slide_1')[0].style.display = 'block';
          return d;
        }
      }).then(pres => {
        presentation = JSON.parse(pres);
      })
    });

    socket.on('nextSlide', function(m) {
      $('#slide_' + presentation.slide)[0].style.display = 'none';
      if(presentation.slide < presentation.img.length) {
        presentation.slide++;
      }
      $('#slide_' + presentation.slide)[0].style.display = 'block';
    })

    socket.on('prevSlide', function(m) {
      $('#slide_' + presentation.slide)[0].style.display = 'none';
      if(presentation.slide > 1) {
        presentation.slide--;
      }
      $('#slide_' + presentation.slide)[0].style.display = 'block';
    })

  </script>

  </body>

</html>
