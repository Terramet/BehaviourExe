<!DOCTYPE html>
<html>

<head>
  <!-- application css-->
  <link rel="stylesheet" href="/stylesheets/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, height=device-height">
  <meta charset="utf-8">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="libs/jquery.ajax-cross-origin.min.js"></script>
  <script src="main.js" type="text/javascript"></script>
  <script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
</head>

<body class="unselectable wrapper">
  <form id="socketID" style="position: absolute; text-align: center; margin-left: auto; margin-right: auto; left: 0; right: 0; margin-top: -5px;"></form>
  <div id="content"></div>
  <div class="footer" id="debugDiv" style="margin-top: 10px; background-color: black; color: green; overflow-y: scroll;"></div>
  <script src="http://localhost:3000/socket.io/socket.io.js"></script>
  <script>
    var robot = null
    var socket = io.connect('http://localhost:3000');
    socket.on('connect', function() {
      console.log(socket.id)
      $('#socketID')[0].innerHTML = socket.id
      $('#socketID')[0].style.display = 'block'

      socket.emit('recieveUserNameSlave', {
        //normally this would be dynamically added based on user input, but for examples sake
        name: 'slave-'
      });

      socket.on('message', function(data) {
        console.log(data)

        $.ajax({
          crossOrigin: true,
          type: 'GET',
          url: window.location.href + '/page',
          success: function(d) {
            $('#content').html(d)
          }
        })


        if (robot === null) {
          robot = new Robot(data.message, function() {
            socket.emit('sendToMaster', {
              socket: data.masterSocket,
              mySocket: socket.id,
              message: 'Connection Established'
            })
          })
          sessionP = robot.getSession()
          sessionP.service("ALMemory").then(function(ALMemory) {
            ALMemory.subscriber("ALTextToSpeech/CurrentWord").then(function(sub) {
              sub.signal.connect(function(value) {
                console.log(value);
                $('#debugDiv').append(" " + value);
              });
            });
          });
        }
      });
    })
  </script>
  <!-- qimessaging & jquery stuff-->
  <script src="/libs/qimessaging/1.0/qimessaging.js"></script>
  <script src="/libs/qimessaging/1.0/socket.io.min.js"></script>
  <script src="/scripts/Session.js"></script>
  <script src="/scripts/Robot.js"></script>
  <script src="/scripts/Playlist.js"></script>
  <script src="/scripts/Assigned.js"></script>
</body>

</html>
